<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
        <title>blog\hrgruri</title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/js/bootstrap.min.js" integrity="sha384-vZ2WRJMwsjRMW/8U7i6PWi6AlO1L79snBrmgiDpgIWJ82z8eA5lenwvxbMV1PAh7" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="/css/style.css">
        <link rel="stylesheet" href="/css/article.css">
        <link rel="stylesheet" href="/css/tag.css">
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/styles/github.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.4.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
                            <script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
              ga('create', 'UA-71610603-3', 'auto');
              ga('send', 'pageview');
            </script>
                <link href="/feed.atom" rel="alternate" title="atom" type="application/atom+xml">
    </head>
    <body style="background-color: white;">
        <div id="blog-header" style="background: #9EFFFF;">
            <div class="container">
                <h1 id="blog-title"><a href="/">blog\hrgruri</a></h1>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div id="blog-main" class="col-xs-12 col-md-8">
                                <div class="blog-article" style="background-color: #FFF1CF;">
            <h1 class="blog-article-title"><a href="/article/2016/06/121113">学年暦のスクレイピングについて</a></h1>
            <div class="blog-article-meta">June 12, 2016</div>
            <div class="blog-article-contents">
                                    <p><a href="/article/2016/06/ritsucal/">前の記事</a>でPHPを使って,学年暦のスクレイピングを行うライブラリの紹介をしたので,今回はそれを作ったことの話をします. スクレイピングは<a href="https://github.com/FriendsOfPHP/Goutte">fabpot/goutte</a>を使用しました</p>
<h2>ページをローカルで動かす</h2>
<p>おそらくコード書いて1回では成功できず,何度も失敗すると思うので,負荷を与えないように対象のページをダウンロードしてローカルで動かしてそこにスクレイピングをしましょう.<br />
Chromeで 'Command(Control) + S'でダウンロードできます. ファイル名はindexでいいです. 次に動かし方ですが, PHPのビルトインサーバを使いましょう.</p>
<pre><code class="language-sh">cd public
php -S localhost:8000
</code></pre>
<p>詳しくは<a href="http://php.net/manual/ja/features.commandline.webserver.php">ここで</a>.</p>
<h2>スクレイピングをする</h2>
<h3>タイトル</h3>
<p>ブラウザで上記のlocalhostにアクセスをして学年暦のタイトル(ページのタイトルではない)を探します.</p>
<ol>
<li><p>2016年度　立命館大学　学年暦</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セメスター制
  （法学研究科、経済学研究科、経営学研究科、社会学研究科、文学研究科、国際関係研究科、政策科学研究科、応用人間科学研究科、言語教育情報研究科、公務研究科、スポーツ健康科学研究科、映像研究科、先端総合学術研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セメスター制
  （理工学研究科、情報理工学研究科、生命科学研究科、薬学研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セッション制
（テクノロジー・マネジメント研究科、経営管理研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦
  （法務研究科）</p>
</li>
</ol>
<p>この5つがあるので,これをタイトルとして,5つの学年暦を取得します. Chromeで右クリック→検証で構造を確かめられるので,見に行くとclass="mod-title type4"が割り振られているので</p>
<pre><code class="language-php">$title = $crawler-&gt;filter('.mod-title.type4')-&gt;eq($i)-&gt;text();
</code></pre>
<p>で得られます.</p>
<h3>年度</h3>
<p>年度ですが,これはタイトル内に書かれているので<a href="http://php.net/preg_match">preg_match()</a>を使って｢2016｣を拾ってあげます.</p>
<h3>各学年暦</h3>
<p>ここからがスクレイピングするのには面倒な構造になっています.というのも, 学部と大学院では構造が異なっているのです. 学部の方は, mod-wysiwyg &gt; set-table &gt; table内にtheadとtbodyが2つ(前期･後期)あります. 一方, 大学院の方はmod-wysiwyg &gt; set-table が2つ(前期･後期)です.<br />
eventはclass="event"ではなくテーブルの要素(イベント名･月･日)だと考えてください. mod-wysiwyは略.</p>
<p><img src="/article/2016/06/121113/structure.jpeg" alt="" /></p>
<p>これは不親切ですね. しかし,うまいこと下から順に配列を結合させていくと,5つの学年暦ができます. 考え方としては, 各学年暦にはset-tableが複数あり,tableの中にもtbodyが複数あることを前提に作るってことです.  結合やイベントのことなどは<a href="https://github.com/hrgruri/ritsucal/blob/master/src/Client.php">コード</a>を見てもらうほうがいいかと.  </p>
<p>同じ日の行事はまとめられているので注意してください.</p>

                            </div>
                    </div>
            <div class="blog-article" style="background-color: #FFF1CF;">
            <h1 class="blog-article-title"><a href="/article/2016/06/ritsucal">立命館の学年暦をスクレイピング</a></h1>
            <div class="blog-article-meta">June 11, 2016</div>
            <div class="blog-article-contents">
                                    <h1>ritsucal</h1>
<p>ritsucalは立命館大学･大学院の学年暦をスクレイピングするPHPのライブラリです. 前から作っていて<a href="https://github.com/hrgruri/ritsucal">GitHub</a>にあげていましたが,久しぶりに見るとREADME.mdに変な文字が混ざっていたので,いくつか修正して,そのついでに簡単な使い方を書きます.</p>
<h2>インストール</h2>
<p>インストールはcomposerからできます</p>
<pre><code class="language-sh">composer require hrgruri/ritsucal
</code></pre>
<h2>使い方</h2>
<pre><code class="language-php">&lt;?php
require 'vendor/autoload.php';
try {
    $client = new Hrgruri\Ritsucal\Client();
    $calenders = $client-&gt;getCalenders();
    var_dump($calenders);
} catch (\Hrgruri\Ritsucal\Exception\UrlException $e) {
    print "Error\n";
}
</code></pre>
<p>こんな感じでコードを書くと動きます. 得られるのは以下の学年暦.  </p>
<ol>
<li><p>2016年度　立命館大学　学年暦</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セメスター制
  （法学研究科、経済学研究科、経営学研究科、社会学研究科、文学研究科、国際関係研究科、政策科学研究科、応用人間科学研究科、言語教育情報研究科、公務研究科、スポーツ健康科学研究科、映像研究科、先端総合学術研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セメスター制
  （理工学研究科、情報理工学研究科、生命科学研究科、薬学研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦 セッション制
（テクノロジー・マネジメント研究科、経営管理研究科）</p>
</li>
<li><p>2016年度　立命館大学大学院　学年暦
  （法務研究科）</p>
</li>
</ol>
<p>var_dump()した結果の一部です</p>
<pre><code>array(5) {
  [0]=&gt;
  object(Hrgruri\Ritsucal\Calender)#66 (2) {
    ["title"]=&gt;
    string(40) "2016年度　立命館大学　学年暦"
    ["events"]=&gt;
    array(79) {
      [0]=&gt;
      object(Hrgruri\Ritsucal\Event)#111 (4) {
        ["year"]=&gt;
        int(2016)
        ["month"]=&gt;
        int(4)
        ["day"]=&gt;
        int(1)
        ["title"]=&gt;
        string(27) "前期セメスター開始"
      }
      [1]=&gt;
      object(Hrgruri\Ritsucal\Event)#65 (4) {
        ["year"]=&gt;
        int(2016)
        ["month"]=&gt;
        int(4)
        ["day"]=&gt;
        int(1)
        ["title"]=&gt;
        string(27) "オリエンテーション"
      }
</code></pre>
<p>デフォルトでは <a href="http://www.ritsumei.ac.jp/profile/info/calender/">http://www.ritsumei.ac.jp/profile/info/calender/</a> から情報を取ってきますが,</p>
<pre><code class="language-php">$calenders = $client-&gt;getCalenders('http://www.ritsumei.ac.jp/profile/info/calender/2016/');
</code></pre>
<p>などのようにすると別の年度の学年暦を取ってくることができます.</p>

                            </div>
                            <ul class="blog-article-tags">
                    Tag:
                                            <li><a href="/tag/php/1">php</a></li>
                                    </ul>
                    </div>
            <div class="blog-article" style="background-color: #FFF1CF;">
            <h1 class="blog-article-title"><a href="/article/2016/06/102235">Saori v0.5を作った</a></h1>
            <div class="blog-article-meta">June 10, 2016</div>
            <div class="blog-article-contents">
                                    <p>Saori v0.5.0をリリースした. これで簡単にユーザが新たなページを生成することができるようになった. そして,<a href="http://hrgruri.github.io/article/2016/06/042227/">前の記事</a>で言っていたテーブルがおかしい理由はテーブルのCSSが記述されていなかったからでした. ボーダの設定を指定なかったので,枠線がない状態で出力されていただけでした.</p>
<hr />
<p>そろそろv0.x系をやめてv1.0にしてもいい頃かもしれない. 最初に思っていた必要な最低限の機能はできたと思う.<br />
それとちゃんとした使い方をまとめて記事かページを生成する必要がある. 今のところ他の人が使うのには不親切だ. README.mdには記事の編集のことしか記述していない. (誰か作る人がいるのかわからないが)テーマの作り方やユーザページについてなど. こういったものをまとめ終えたらv1.0.0にしたいと思います.</p>

                            </div>
                    </div>
            <div class="blog-article" style="background-color: #FFF1CF;">
            <h1 class="blog-article-title"><a href="/article/2016/06/042227">Saori v0.5.x-devにてTableがおかしい</a></h1>
            <div class="blog-article-meta">June 4, 2016</div>
            <div class="blog-article-contents">
                                    <p>現在Saoriのv0.5を作っていますが, どうやらテーブルが正しく表示されないです.</p>
<pre><code class="language-markdown">|name|値|
|:-:|:-:|
|f85|キーワード|
|f23|絵師|
|f83|画題|
</code></pre>
<p>上記の記述をしたら以下の様なテーブルが生成されました.</p>
<p><img src="/article/2016/06/042227/table.png" alt="" /></p>
<p>罫線が入っていないので,テーブルとしてわかりにくくなっています. 今のところ原因がわかっていません. Atomの上では正しく表示されているので記述に間違いはないのではないかとは思います. cebe/markdownを使ってMarkdownを変換しています. とりあえず他のライブラリを使ってみてどう表示されるのか試してみます. あとHTMLも確認してみたいと思います.</p>
<p>ちなみにv0.5.x-devでは記事とユーザページ(contents/page/NAME.md)の画像ファイルのパスの書き換えはできるようになりました. </p>

                            </div>
                            <ul class="blog-article-tags">
                    Tag:
                                            <li><a href="/tag/saori/1">saori</a></li>
                                    </ul>
                    </div>
            <div class="blog-article" style="background-color: #FFF1CF;">
            <h1 class="blog-article-title"><a href="/article/2016/06/arc">立命館ARCのスクレイピング</a></h1>
            <div class="blog-article-meta">June 2, 2016</div>
            <div class="blog-article-contents">
                                    <h1>PHPでスクレイピング</h1>
<p>創成3では立命館大学アート・リサーチセンター(以下ARC)のアクセスログを使って資料の推薦を行うことが目的でした. 最初はリンクだけを使った質素なものを作る予定でしたが, 途中でスクレイピングをして, サイト内だけで簡単な検索･閲覧をできるようにすることになりました. PHPを使ってやったのですが,これがとっても大変でした.</p>
<h2>謎のname</h2>
<p>HTMLのFormのほとんどにはname属性がつけられています.</p>
<pre><code class="language-html">&lt;input type="text" name="username"&gt;
</code></pre>
<p>nameからどういった値が入るのか推測できるようになっているべきです.上の例だとユーザ名が入るのだと推測できます. しかしながらARCのフォームでは全くそれがなされていなかった.</p>
<h3>浮世絵データベース</h3>
<table>
<thead>
<tr><th align="center">name</th><th align="center">値</th></tr>
</thead>
<tbody>
<tr><td align="center">f85</td><td align="center">キーワード</td></tr>
<tr><td align="center">f23</td><td align="center">絵師</td></tr>
<tr><td align="center">f83</td><td align="center">画題</td></tr>
</tbody>
</table>
<h3>古典籍データベース</h3>
<table>
<thead>
<tr><th align="center">name</th><th align="center">値</th></tr>
</thead>
<tbody>
<tr><td align="center">f61</td><td align="center">資料名</td></tr>
<tr><td align="center">f63</td><td align="center">編著者</td></tr>
</tbody>
</table>
<p>まったく謎です. ちなみに浮世絵DBの絵師であるf23ですが,古典籍DBでは資料のソート(成立月日順)のために使われています.
ちなみに統一されているものも一応あります.</p>
<table>
<thead>
<tr><th align="center">name</th><th align="center">値</th></tr>
</thead>
<tbody>
<tr><td align="center">-max</td><td align="center">表示件数</td></tr>
<tr><td align="center">skip</td><td align="center">スキップ数</td></tr>
</tbody>
</table>
<p>この2つは推測できますね. なぜかmaxではなく-maxですが. 統一されておらず,推測できないのはスクレイピングする側としては辛いですね. サーバサイドのコードを書くに扱いづらくなかったのでしょうか?</p>
<h2>作ったライブラリ</h2>
<p>オープンキャンパスのために創成3のサイトを再び作っているので使っているが, それさえ終わればもう使うことはないと思う. <a href="https://github.com/hrgruri/rarcs">GitHub</a>にアップロードしています. またComposerからインストールして使うことができます.</p>
<pre><code class="language-sh">composer require hrgruri/rarcs
</code></pre>
<pre><code class="language-php">&lt;?php
require 'vendor/autoload.php';

$client = new Hrgruri\Rarcs\NishikieClient();
var_dump($client-&gt;getDetail('arcUP2435'));
/*
object(Hrgruri\Rarcs\Asset\Nishikie)#51 (5) {
  ["artist"]=&gt;
  string(6) "広貞"
  ["id"]=&gt;
  string(9) "arcUP2435"
  ["url"]=&gt;
  string(62) "http://www.dh-jac.net/db/nishikie/results-big.php?f1=arcUP2435"
  ["title"]=&gt;
  string(54) "「菅原　三ノ口」「松王丸」「梅王丸」"
  ["cover"]=&gt;
  string(87) "http://www.arc.ritsumei.ac.jp/archive01/theater/image/PB/arc/Prints/arcUP/arcUP2435.jpg"
}
 */
</code></pre>

                            </div>
                            <ul class="blog-article-tags">
                    Tag:
                                            <li><a href="/tag/php/1">php</a></li>
                                    </ul>
                    </div>
                <ul class = "pager">
            <li class = "next_link"><a href = "/page/2">Next &rarr;</a></li>
        </ul>
                    </div>
                                                    <div id="blog-side"
                        class="col-xs-12 col-md-3 col-md-offset-1"
                        style="background-color: #91D0EF;"
                    >
                                                    <p><a href="/about">About</a></p>
<hr />
<p><a href="https://github.com/hrgruri" title="GitHub">GitHub</a>  </p>
<hr />
<p><a href="https://twitter.com/hrgruri" title="Twitter">Twitter</a></p>

                                            </div>
                            </div>
        </div>
    </body>
</html>
